# Azure Cloud SOC Lab

This lab demonstrates a cloud-native Security Operations Center (SOC) environment in Microsoft Azure using Microsoft Sentinel and Azure Monitor. It is designed for learning and simulating real-world SOC activities such as attack detection, logging, and incident monitoring.

---

## Table of Contents
- [Overview](#overview)
- [Architecture](#architecture)
- [Components](#components)
- [Setup Steps](#setup-steps)
- [Attack Simulation](#attack-simulation)
- [Queries](#queries)
- [Dashboards & Alerts](#dashboards--alerts)
- [Future Enhancements](#future-enhancements)

---

## Overview

This project sets up a SOC lab in Azure to collect, analyze, and visualize security events from cloud-hosted virtual machines. It covers:

- Cloud log collection via **Azure Monitor Agent**  
- Security event ingestion into **Microsoft Sentinel**  
- Attack simulations (RDP brute-force, network scanning)  
- KQL-based detection and dashboarding  

The lab provides a hands-on environment for learning **cloud security**, **SIEM operations**, and **threat detection**.

---

## Architecture
[Attacker VM / Host Machine] --> [Azure VM: soc-target]
logs sent via Azure Monitor Agent --> [Log Analytics Workspace: soc-lab]
analyzed in --> [Microsoft Sentinel SIEM]


- **Attacker VM / Host**: Generates attack traffic (RDP brute-force, Nmap scans)  
- **Target VM (soc-target)**: Windows Server 2025 running Sysmon and monitored by Azure Monitor  
- **Log Analytics Workspace (soc-lab)**: Centralized log collection  
- **Microsoft Sentinel**: SIEM for detection, alerting, dashboards  

---

## Components

| Component | Purpose |
|-----------|---------|
| Azure VM: soc-target | Simulated target for attacks, running Windows Server 2025 |
| Azure Monitor Agent | Collects Windows Event Logs and Sysmon logs |
| Data Collection Rule / Data Connector | Sends logs to Log Analytics Workspace |
| Log Analytics Workspace: soc-lab | Stores and centralizes logs |
| Microsoft Sentinel | Detects, investigates, and visualizes attacks |
| Sysmon | Monitors process and network activity on target VM |
| Attacker machine (optional Kali VM) | Generates test attacks |

---

## Setup Steps

1. **Create Azure Resources**  
   - Resource Group: `cloud-soc-lab`  
   - Log Analytics Workspace: `soc-lab`  
   - Azure VM: `soc-target` (Windows Server 2025, B1s/B2s)

2. **Install Monitoring Agent**  
   - Azure Monitor Agent deployed automatically via DCR or Sentinel connector  

3. **Configure Data Collection**  
   - Collect **Windows Security Events** (e.g., Event ID 4625)  
   - Collect **Sysmon Operational Logs** (Event ID 1: process create, Event ID 3: network connections)  

4. **Attach VM to Sentinel**  
   - Use **Microsoft Sentinel** Data Connector or DCR  
   - Verify logs are flowing with queries like:

```kusto
SecurityEvent
| where EventID == 4625
| take 20

Event
| where EventLog == "Microsoft-Windows-Sysmon/Operational"
| take 20
```
5. **Test Logging**
   - Trigger failed RDP logins
   - Run network scans (Nmap, ping)
6. **Build Detection Rules & Dashboards**
   - Brute-force detection
   - Port scan detection
   - Incident timeline dashboards

## Attack Simulation

- **RDP brute-force attacks**: Repeated failed login attempts to generate Event ID 4625  
- **Network scans (TCP/ICMP)**: Using Nmap to generate Sysmon Event ID 3 entries  
- **Process monitoring**: Sysmon Event ID 1 captures process creation  

---

## Queries

### Failed login attempts
```kusto
SecurityEvent
| where EventID == 4625
| summarize Attempts = count() by Account, bin(TimeGenerated, 5m)
| top 10 by Attempts
```
### Top network connections detected by Sysmon
```kusto
Event
| where EventLog == "Microsoft-Windows-Sysmon/Operational" and EventID == 3
| summarize Attempts = count() by SourceIp, DestinationPort
| top 10 by Attempts
```
## Dashboards & Alerts
- Top attacking IPs over time
- Faield login trends
- Network scan visualization
- Incidents auto-generated by Sentinel Analytics Rules

## Future Enhancements
- Integrate Threat Intelligence feeds (AbuseIPBD, MISP)
- Create automated playbooks for incident response
- Deploy additional VMs to simulate lateral movement

## References
- ![Microsoft Sentinel Documentation](https://learn.microsoft.com/en-us/azure/sentinel)
- ![Sysmon Documentation](https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon)
- ![Azure Monitor Agent Documentation](https://learn.microsoft.com/en-us/azure/azure-monitor/agents/agents-overview)
